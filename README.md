# GitHub Action: Wait For Terraform Plan Approval

This action uses an external service (https://terraform-plan-approval.herokuapp.com/, [GitHub](https://github.com/jbergknoff/terraform-plan-approval)) to allow a GitHub Action workflow to prompt a user to approve or reject a Terraform plan before proceeding. This is just for demonstration purposes, and should not be used for anything important because the service has no authentication/authorization and is fully public. If you need this functionality for real workloads, considering running an instance of https://github.com/jbergknoff/terraform-plan-approval on a private network.

## Inputs

### `command`

**Required** What to do: either `submit` (submit a plan to the external service) or `wait` (wait for a human to approve/reject a previously-submitted plan).

### `plan_contents`

**Required when `command == submit`** The plaintext contents of the Terraform plan. ANSI color codes are supported, and will be colorized when the plan is displayed for review.

### `plan_id`

**Required when `command == wait`** The plan id to wait for. This will be retrieved as an output after running with `command == submit`.

### `external_service_url`

(Optional) Override the URL of the external service. Defaults to the insecure, underpowered https://terraform-plan-approval.herokuapp.com.

### `timeout_seconds`

(Optional, default `300`) For `command == wait`, give up waiting for approval/rejection after this many seconds.

### `polling_period_seconds`

(Optional, default `5`) For `command == wait`, the interval (in seconds) at which we'll check the plan status.

## Outputs

### `plan_id`

When running with `command == submit`, returns the plan id generated by the external service which we will subsequently pass to the `wait` command.

### `approval_prompt_url`

When running with `command == submit`, returns the URL that a human should visit to review and approve/reject the plan.

### `plan_status`

When running with `command == wait`, returns the final status of the plan: either 'approved', 'rejected', or 'timed out'.

## Example usage

### TODO write a workflow/test using this and then fill this out
uses: jbergknoff/github-action-wait-for-terraform-plan-approval@v1
with:
  who-to-greet: 'Mona the Octocat'
